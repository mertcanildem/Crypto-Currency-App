//
//  MarketModel.swift
//  CryptoApp
//
//  Created by Mert can Ildem on 13.11.2025.
//

import Foundation
//JSON Data:
/*
 URL: https://api.coingecko.com/api/v3/global
 JSON Response:
 {"data":{"active_cryptocurrencies":19426,"upcoming_icos":0,"ongoing_icos":49,"ended_icos":3376,"markets":1413,"total_market_cap":{"btc":34668128.92537609,"eth":1025378127.6778104,"ltc":35259800687.94646,"bch":6795699825.676516,"bnb":3693431094.399326,"eos":13373027762047.955,"xrp":1437203512730.7795,"xlm":12315297279068.826,"link":227545454315.89304,"dot":1184087442454.8025,"yfi":720137955.4464015,"sol":22901048665.203518,"usd":3555807444276.12,"aed":13058702839104.06,"ars":5.017357022969593e+15,"aud":5423153946867.504,"bdt":434292588715535.75,"bhd":1340475401958.101,"bmd":3555807444276.12,"brl":18782845218707.21,"cad":4978592676954.327,"chf":2829597778316.7217,"clp":3300429353628211.5,"cny":25233787528305.508,"czk":74038812812078.19,"dkk":22860346507977.746,"eur":3061276412348.532,"gbp":2699288102906.335,"gel":9600680099545.531,"hkd":27630583091927.273,"huf":1175974028008335.2,"idr":5.947923565301218e+16,"ils":11416570512610.791,"inr":315373618874409.94,"jpy":550138526644902.44,"krw":5.205740554477753e+15,"kwd":1090815049680.586,"lkr":1083038157442439.4,"mmk":7.466128890746573e+15,"mxn":64948430194668.19,"myr":14681928937416.11,"ngn":5.126229802040671e+15,"nok":35728877653347.01,"nzd":6275637446788.038,"php":209333925828749.84,"pkr":1.004367268944659e+15,"pln":12943676024089.172,"rub":286946204224872.44,"sar":13334164130197.24,"sek":33484750682345.26,"sgd":4624850284975.405,"thb":114888138524561.53,"try":150247087750443.28,"twd":110558224688051.6,"uah":149462321047491.53,"vef":356042999395.36786,"vnd":9.362316194782382e+16,"zar":60507877409529.61,"xdr":2506037079924.8154,"xag":66316342206.86632,"xau":839561695.668035,"bits":34668128925376.086,"sats":3466812892537608.5},"total_volume":{"btc":1743985.4405839157,"eth":51581800.95650771,"ltc":1773749577.6029184,"bch":341858701.98156154,"bnb":185798606.79234698,"eos":672732173222.7905,"xrp":72298738900.90102,"xlm":619522882166.21,"link":11446708308.145737,"dot":59565696910.39416,"yfi":36226648.1763053,"sol":1152040698.0194528,"usd":178875428370.70444,"aed":656920010691.4125,"ars":252398899782143.5,"aud":272812575081.29343,"bdt":21847154004293.484,"bhd":67432816738.04494,"bmd":178875428370.70444,"brl":944873854158.0012,"cad":250448853524.67453,"chf":142343341883.69882,"clp":166028595105120.56,"cny":1269389477432.705,"czk":3724533615884.535,"dkk":1149993169877.542,"eur":153997970419.19208,"gbp":135788094060.19763,"gel":482963656600.9023,"hkd":1389960638801.4067,"huf":59157550376194.984,"idr":2992111896756703.5,"ils":574312296987.5387,"inr":15864917337913.848,"jpy":27674801338087.742,"krw":261875561672469.3,"kwd":54873615161.28104,"lkr":54482397427393.17,"mmk":375584736949968.25,"mxn":3267240550884.542,"myr":738576643742.639,"ngn":257875761310626.16,"nok":1797346564908.831,"nzd":315696885780.5996,"php":10530574628110.033,"pkr":50524846547354.11,"pln":651133569459.0486,"rub":14434871967742.564,"sar":670777132376.4341,"sek":1684455420057.2268,"sgd":232653789284.07172,"thb":5779465090657.465,"try":7558202350375.751,"twd":5561648123779.601,"uah":7518724543334.335,"vef":17910796642.758633,"vnd":4.709727245156296e+15,"zar":3043857875052.924,"xdr":126066572279.10655,"xag":3336053570.427895,"xau":42234277.39260703,"bits":1743985440583.9158,"sats":174398544058391.56},"market_cap_percentage":{"btc":57.53991524301336,"eth":11.758495615751642,"usdt":5.1619941373040445,"xrp":4.180472940794882,"bnb":3.7236375329118734,"sol":2.4192430653183976,"usdc":2.1381144344537892,"steth":0.8424165512668277,"trx":0.7914693973503917,"doge":0.7474506995994715},"market_cap_change_percentage_24h_usd":-2.081917917852273,"updated_at":1763040732}}
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
    
}
